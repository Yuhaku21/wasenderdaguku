<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daguku WhatsApp Sender</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:Inter}
body{
  margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;
  background:radial-gradient(circle at top,#1f2933,#000);color:#e5e7eb;padding:16px
}
.card{
  width:100%;max-width:420px;background:rgba(17,24,39,.9);
  padding:26px;border-radius:18px;box-shadow:0 0 40px rgba(37,211,102,.2)
}
.hidden{display:none}
input,select,button{
  width:100%;padding:13px;border-radius:12px;margin-bottom:14px;border:none
}
input,select{background:#020617;color:#fff}
button{background:#25D366;font-weight:600;cursor:pointer}
.logout{background:#ef4444}
.preview{background:#020617;padding:12px;border-radius:12px}
</style>
</head>

<body>

<div class="card" id="login">
  <h3>üîê Login Worker</h3>
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div class="card hidden" id="dashboard">
  <h3>üí¨ Daguku WhatsApp Sender</h3>

  <input id="phone" placeholder="628xxxx">

  <select id="message" onchange="preview()">
    <option value="">-- Pilih pesan --</option>
    <option value="Halo kak, mohon kode verifikasi ya üòä">Minta Kode</option>
    <option value="Data akun masih salah kak üôè">Data Salah</option>
    <option value="Order sudah selesai kak üòä">Order Selesai</option>
  </select>

  <button onclick="sendWA()">Kirim WhatsApp</button>
  <button class="logout" onclick="logout()">Logout</button>

  <div class="preview hidden" id="previewBox">
    <p id="previewText"></p>
  </div>
</div>

<script>
/* === AUTO LOGIN === */
if(localStorage.getItem("token")){
  showDashboard();
}

/* === LOGIN === */
async function login(){
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;

  const res = await fetch("/api/login",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ username, password })
  });

  const data = await res.json();

  if(data.token){
    localStorage.setItem("token", data.token);
    showDashboard();
  }else{
    alert("Login gagal");
  }
}

function showDashboard(){
  document.getElementById("login").classList.add("hidden");
  document.getElementById("dashboard").classList.remove("hidden");
}

function logout(){
  localStorage.removeItem("token");
  location.reload();
}

function preview(){
  const msg = message.value;
  if(!msg) return;
  previewBox.classList.remove("hidden");
  previewText.innerText = msg;
}

function sendWA(){
  if(!phone.value || !message.value) return alert("Lengkapi data");
  window.open(`https://wa.me/${phone.value}?text=${encodeURIComponent(message.value)}`);
}
</script>

</body>
</html>